# This task tests individual platforms and versions
variables:
  # indicate whether the testsuite should skip long running tests or not.
  - name: jpypetest.fast
    value: 'false'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(python.version)'

- template: jdk.yml
  parameters:
    version: 11

- script: |
    python setup.py build_ext --inplace
  displayName: 'Build module'

- script: |
    pip install numpy jedi typing_extensions
    python -c "import jpype"
  displayName: 'Check module'

- script: |
    python setup.py test_java
    pip install -r test-requirements.txt
  displayName: 'Install test'

- script: |
    python -m pytest -v --junit-xml=build/test/test.xml test/jpypetest --checkjni
  displayName: 'Test JDK 11'
  condition: eq(jpyptest.fast, 'false')

- script: |
    python -m pytest -v --junit-xml=build/test/test.xml test/jpypetest --checkjni --fast
  displayName: 'Test JDK 11 (fast)'
  condition: eq(jpyptest.fast, 'true')

- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs:
     testResultsFiles: 'build/test/test.xml'
     testRunTitle: 'Publish test results for Python $(python.version) with JDK 11'

